#!/bin/bash

export PYTHONDONTWRITEBYTECODE=1
export PY3='python3'


function help() {
    echo 'tup - rpc framework'
    echo "usage: $0 <command> [args] [options]"
    echo 'commands'
    echo ' init                      - init a tup project'
    echo ' start modspec [modspec]   - start rpc server'
    echo ' rpc srv::method arg [arg]  - trigger rpc request'
    echo ' config set sec/key value  - set grand config'
    echo ' config get <sec/key|sec>  - print grand config by key or section'
    echo ' config del <sec/key|sec>  - delete given config key'
    echo ' config clear              - clear all grand config'
    echo ' config dump               - dump all grand config'
    echo ' config load <config.json> - load config from json file'
}

case "$1" in
    init)
        exec $PY3 -m aiotup.tools.initprj "${@:2}"
        ;;
    start)
        lang=`$PY3 -m aiotup.tools.printcfg language`
        if [ $lang == 'python3' ]; then
            exec $PY3 -m aiotup.tools.startprj "${@:2}"
        else
            # TODO: support nodejs
            echo language $lang not supported
            exit 1
        fi
        ;;
    rpc)
        exec $PY3 -m aiotup.tools.rpcclient "${@:2}"
        ;;
    config)
        exec $PY3 -m aiotup.tools.grandconfig "${@:2}"
        ;;
    *)
        help
        ;;
esac
